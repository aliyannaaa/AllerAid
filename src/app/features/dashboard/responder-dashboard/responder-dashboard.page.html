<ion-header translucent>
  <ion-toolbar color="primary">
    <ion-title>BuddyCare Dashboard</ion-title>
  </ion-toolbar>
</ion-header>

<ion-content class="ion-padding">
  <ion-grid>
    <!-- Emergency Alert Card -->
    <ion-row>
      <ion-col size="12">
        <ion-card class="emergency-card emergency-pulse" *ngIf="currentEmergency">
          <ion-card-header class="emergency-header">
            <ion-card-title>INCOMING EMERGENCY ALERT</ion-card-title>
            <ion-note slot="end">{{ currentEmergency.timestamp?.toDate() | date:'short' }}</ion-note>
          </ion-card-header>

          <ion-card-content>
            <ion-item lines="none">
              <ion-label>
                <h2>Emergency from {{ currentEmergency.userName || 'Patient' }}</h2>
                <p>Medical Emergency</p>
              </ion-label>
              <ion-badge color="danger">CRITICAL</ion-badge>
            </ion-item>

            <ion-label class="label-heading">Patient Location</ion-label>
            <div class="map-container"></div>
            <ion-text color="primary">
              <p><ion-icon name="location"></ion-icon> {{ currentEmergency.location ? (currentEmergency.location.latitude + ', ' + currentEmergency.location.longitude) : 'Location updating...' }}</p>
            </ion-text>

            <ion-label class="label-heading">Emergency Details</ion-label>
            <ion-text class="instruction-box">{{ currentEmergency.instruction || 'Emergency details not provided' }}</ion-text>

            <ion-item lines="none" class="voice-item">
              <ion-button fill="clear" color="primary" (click)="playVoiceMessage()">
                <ion-icon name="play" slot="start"></ion-icon>
                Voice message available
              </ion-button>
            </ion-item>

            <!-- Action Buttons -->
            <ion-row class="button-grid">
              <ion-col size="6">
                <ion-button expand="block" color="success" (click)="responded()" [disabled]="hasResponded">
                  <ion-icon slot="start" name="checkmark-circle-outline"></ion-icon>
                  I'm On My Way
                </ion-button>
              </ion-col>

              <ion-col size="6">
                <ion-button expand="block" color="medium" (click)="cannotRespond()">
                  <ion-icon slot="start" name="close-circle-outline"></ion-icon>
                  Cannot Respond
                </ion-button>
              </ion-col>

              <ion-col size="6">
                <ion-button expand="block" color="primary" (click)="navigate()">
                  <ion-icon slot="start" name="navigate"></ion-icon>
                  Navigation
                </ion-button>
              </ion-col>

              <ion-col size="6">
                <ion-button expand="block" color="success" (click)="markResolved()">
                  <ion-icon slot="start" name="checkmark-done-circle-outline"></ion-icon>
                  Mark as Resolved
                </ion-button>
              </ion-col>

              <ion-col size="12">
                <ion-button expand="block" class="speak-alert" (click)="speakAlert()">
                  <ion-icon slot="start" name="megaphone-outline"></ion-icon>
                  Speak Alert
                </ion-button>
              </ion-col>
            </ion-row>

            <ion-card color="success" class="confirmation-card" *ngIf="hasResponded">
              <ion-card-content class="ion-text-center">
                <ion-icon name="checkmark-circle-outline" color="dark" size="large"></ion-icon>
                <p class="ion-margin-top">You have responded to this emergency</p>
              </ion-card-content>
            </ion-card>
          </ion-card-content>
        </ion-card>

        <!-- No Emergency Card -->
        <ion-card *ngIf="!currentEmergency">
          <ion-card-header>
            <ion-card-title>BuddyCare Dashboard</ion-card-title>
            <ion-card-subtitle>No active emergencies</ion-card-subtitle>
          </ion-card-header>
          <ion-card-content>
            <div class="ion-text-center">
              <ion-icon name="checkmark-circle-outline" size="large" color="success"></ion-icon>
              <p>All quiet. You'll be notified of any emergencies from your patients.</p>
            </div>
          </ion-card-content>
        </ion-card>
      </ion-col>
    </ion-row>
  </ion-grid>
</ion-content>

